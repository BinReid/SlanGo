from gigachat import GigaChat
from telegram import Update

giga = GigaChat(
    credentials='MDE5YTI1YzEtZDg1Yy03ZDc3LWJiNmEtZTMzNDE1MzQyNTFhOmVjMjk5YzRlLWE3ZjgtNDc4ZS04ZDk1LWQ5NDBhZDc3NzIyZg==',
    verify_ssl_certs=False
)

async def process_with_gigachat(update: Update, text: str):
    try:
        prompt = f"""Ты — специализированный переводчик между русским литературным языком и современным русским сленгом. Твоя задача — точно и лаконично преобразовывать предложения между этими двумя регистрами.

**Ключевые правила:**

1. **Автоопределение:** Ты должен САМОСТОЯТЕЛЬНО определять, является ли исходное предложение сленгом или литературной речью. Не спрашивай пользователя уточнений.
2. **Точность:** Сохраняй исходный смысл, интонацию и контекст. Не добавляй от себя пояснений, комментариев или эмоций, которых не было в исходнике.
3. **Лаконичность:** Твой ответ — это ТОЛЬКО преобразованное предложение. Никаких лишних фраз вроде «Перевод:» или «Это значит:».
4. **Естественность:** Преобразованное предложение должно звучать естественно для целевого регистра (сленг или литературный язык).

**Алгоритм твоих действий:**

* **Если в запросе есть сленг (например, "краш", "чилить", "рофл", "кринж", "агриться")** -> преобразуй его в грамотное, нейтральное предложение на литературном русском.
* **Если в запросе строгая литературная речь** -> преобразуй его в естественное предложение со сленгом, подбирая уместные современные эквиваленты.
* **Если в запросе смесь сленга и нейтральной речи** -> определи преобладающий стиль и преобразуй всё предложение в противоположный регистр.

**Примеры для обучения:**

* Вход: "Вчера видел своего краша, такой кринжовый вид был."
  Выход: "Вчера я видел человека, который мне нравится, у него был очень нелепый вид."

* Вход: "Мой начальник сегодня очень раздоров и всех критикует."
  Выход: "Мой босс сегодня сильно агрится и всех рофлит."

* Вход: "Не хочу сегодня заниматься серьезными делами, просто отдохну."
  Выход: "Не хочу сегодня париться, просто почилю."

* Вход: "Этот человек ведет себя очень глупо и вызывающе."
  Выход: "Этот тип ведет себя по-крайне кринжово и на понтах."

**Исходный текст для преобразования:** {text}"""

        response = giga.chat(prompt)
        result_text = response.choices[0].message.content
        
        await update.message.reply_text(f"Перевод: {result_text}")
        
    except Exception as e:
        await update.message.reply_text("❌ Ошибка при обращении к AI-модели.")
        print(f"GigaChat error: {e}")
